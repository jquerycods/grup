SpilGames("spilgames.import",{name:"EventTracker",deps:"TrackerData Tracker LocalStorage Utils JSLib Portal RefTag FeatureDetector".split(" "),module:function(){return function(g,k,l,e,f,q,h,n){if(window.trackerInstance)return f("spilgames.debug.%s.eventTracker".replace("%s","info"),"reuse instance var"),window.trackerInstance;var b=this,c,a=f.ns+".module.tracker.event.",m="eventCategory eventAction eventLabel eventValue timing properties".split(" "),w={"interval.communicate":10,"interval.heartbeat":120,
"net.sendFormat":"autoselect","net.sendMethod":"post","net.dataFormat":"object"},r=0,u=[],v,t=!1,p=e.getNavigationStartTime(),d={},x=function(a){c?g.getSessionId(function(b){l.getItem({key:"TRACKER.event."+b},function(b){a(e.isArray(b)?b:[])})}):a(u)},H=function(a,b){c?g.getSessionId(function(d){l.setItem({key:"TRACKER.event."+d,value:a,expires:1E3},function(d){c=d;e.isFunction(b)&&b(a)})}):(u=a,e.isFunction(b)&&b(u))},I=function(){c&&g.getSessionId(function(a){l.removeItem("TRACKER.event."+a)});
u=[]},J=function(a,b){x(function(d){d.push(a);H(d);b(d)})},y=function(a,d,m){m=m||e.emptyFn;!1===("object"===typeof d&&Object(d)===d)&&(d={sendFormat:b.settings.get("net.sendFormat"),sendMethod:b.settings.get("net.sendMethod"),dataFormat:b.settings.get("net.dataFormat")});e.isArray(a)||(a=[a]);k.send({settings:d,request:{eventList:a}},m)},K=function(a,b){var d;return{start:function(){d=window.setInterval(b,a)},stop:function(){window.clearInterval(d)}}},z=function(a,b,m){d[a]=K(1E3*b,m);return d[a]},
A=function(){for(var a in d)d[a]&&d[a].stop();p=0},B=function(a){a=a||e.emptyFn;!0===f.get("tracker.event.disable")&&A();x(function(b){a(b);f("spilgames.debug.%s.eventTracker".replace("%s","debug"),{msg:"communicate queue: ",data:b});0<b.length&&(y(b),I())})},L=function(){p||(p=+new Date);z("communicate",b.settings.get("interval.communicate"),B);z("heartbeat",b.settings.get("interval.heartbeat"),function(){var a=g.getPageInfo();delete a.userAgent;delete a.referrerURL;y({eventCategory:"heartbeat",
eventAction:"ping",timing:parseInt(+new Date-p,10),properties:a})});d.communicate.start();d.heartbeat.start()},C=function(a){var b,d=!0;if(!0===e.isArray(a))return e.each(a,function(a){!1===C(a)&&(d=!1)}),d;if(!1===("object"===typeof a&&Object(a)===a))return!1;for(b in a)if(e.has(a,b)&&!1===e.contains(m,b)){d=!1;break}return d},D=function(a,b){g.getPageInSession(function(d){e.each(a,function(a){a.timing=parseInt(+new Date-p,10);a.pageInSession=d});b(a)})},E=function(a,b){var d={callback:a.callback||
b||e.emptyFn,settings:a.settings||void 0,data:a.data||a};if(!1===C(d.data))f("spilgames.debug.%s.eventTracker".replace("%s","debug"),"trackExpress() data argument was invalidated"),d.callback(!1);else return!1===e.isArray(d.data)&&(d.data=[d.data]),d},F=function(a){!1===t&&0===r?g.incrementPageInSession(function(b){t=!0;a()}):a()},G=function(a){a=a||e.emptyFn;h.getReferrerTag(function(b){var d=g.getPageInfo();d.referrerTag=b;k.send({settings:{sendFormat:"gif",sendMethod:"get",dataFormat:"string"},
request:d},a)})};b.settings={values:w,get:function(a){a=w[a];return void 0!==a?a:null},set:function(a,b){v||(w[a]=b)}};b.sendPageview=function(a){a=a||e.emptyFn;f("spilgames.debug.%s.eventTracker".replace("%s","debug"),"sendPageview, pageviewSequence: "+r+", internalPageview?:"+t);r+=1;1===r&&!0===t?G(a):g.incrementPageInSession(function(b){G(a)})};window.trackerInstance={setTracker:function(a){k=a},init:function(){if(v)return!1;h.init();c=n.localStorage()?!0:!1;e.each(b.settings.values,function(d,
m){var p=f.get(a+m);null!==p&&b.settings.set(m,p)});L();v=!0},stop:function(){A();d={};t=v=!1;r=0},track:function(a,b){var d=E(a,b);d&&F(function(){D(d.data,function(a){e.each(a,function(a){J(a,function(b){f("spilgames.debug.%s.eventTracker".replace("%s","info"),{msg:"Queued localStorage "+(c?"supported":"unsupported"),added:a,queue:b})})})});x(function(a){d.callback(a)})})},trackExpress:function(a,b){var d=E(a,b);d&&F(function(){D(d.data,function(a){y(a,d.settings,d.callback)})})},sendPageview:b.sendPageview,
settings:b.settings,flushQueue:B};f("spilgames.debug.%s.eventTracker".replace("%s","info"),"instance created");return window.trackerInstance}}()});SpilGames("spilgames.module.import.loadmodule",{name:"Heatmap",deps:["JSLib"],module:function(g){function k(b,c,a){if(b&&c&&a){if(!f&&0<e.width&&0<e.height){f=!0;var m=h.init;h.track===m&&q.push(void 0);g(m,void 0);0<e.width&&0<e.height&&k("browser","viewportSize",e.width+"x"+e.height)}f&&(m=h.track,b={eventCategory:b,eventAction:c,eventLabel:a},h.track===m&&q.push(b),g(m,b))}}var l={left:0,top:0},e={width:0,height:0},f=!1,q=[],h={init:"tracker.event.init",track:"tracker.event.track"},n=Math.round;
return{trackClick:function(b){if(b&&b.hasOwnProperty("x")&&b.hasOwnProperty("y")){var c;c=n(b.x+document.body.scrollLeft+document.documentElement.scrollLeft-l.left);b=n(b.y+document.body.scrollTop+document.documentElement.scrollTop-l.top);c=[c,b].join();k("interaction","click",c)}},setOffset:function(b){l.left=n(b.left)||0;l.top=n(b.top)||0},getOffset:function(){return l},setViewport:function(b){e.width=n(b.width)||0;e.height=n(b.height)||0},getViewport:function(){return e},__getEvents:function(){return q}}}});SpilGames("spilgames.import",{name:"PageTracker",deps:["EventTracker"],module:function(g){return{track:function(k,l){g.sendPageview(k||l)}}}});SpilGames("spilgames.import",{name:"RefTag",deps:["DOMEvent","Cache"],module:function(g,k){function l(a){return a&&"BODY"!==a.tagName?-1<a.className.indexOf("wdg_")?a:l(a.parentNode):!1}function e(a,b){return a&&b?a.getAttribute("name")?a:a===b?!1:e(a.parentNode,b):!1}function f(a,b){return b&&a&&a!==b?"LI"===a.tagName||"ARTICLE"===a.tagName?a:f(a.parentNode,b):!1}function q(a){var b=a.widget;a.namedElement&&(b+="-"+a.namedElement.getAttribute("name"));a.position&&(b+="-"+a.position);return b}function h(a){a=
a||window.event;var b=a.target||a.srcElement;if("object"===typeof b){a=l(b);var c;c=a?(c=/wdg_(\w+)/.exec(a.className))?c[1]:!1:!1;var g=e(b,a);if(b=f(b,g||a)){for(var h=1;b=b.previousSibling;)"LI"!==b.tagName&&"ARTICLE"!==b.tagName||h++;b=h}else b=!1;h={};a&&c&&(h={page:n,widget:c,namedElement:g||!1,position:b||!1},k.setItem({key:"reffererTag",value:q(h),expires:60}))}}var n,b=window,c=(b.performance||b.webkitPerformance||b.mozPerformance||b.msPerformance||{}).navigation;return{init:function(a){n=
a;g.add("body","click",h)},getReferrerTag:function(a){k.getItem({key:"reffererTag"},function(b){if(!b&&c&&c.type)switch(c.type){case c.TYPE_RELOAD:b="browser_reload";break;case c.TYPE_BACK_FORWARD:b="browser_back_forward"}a(b||!1);k.removeItem({key:"reffererTag"})})}}}});SpilGames("spilgames.import",{name:"TrackerData",deps:"Utils Cache SPAPI JSLib Portal FeatureDetector".split(" "),module:function(g,k,l,e,f,q){var h=this,n=e.get(h.ns+".module.tracker.environment"),b={},c=function(p){b.hasOwnProperty("Tracker.session")?p(b["Tracker.session"]):k.getItem({key:"Tracker.session"},function(b){!g.isEmpty(b)&&g.isNumber(b.sessionId)?p(b):a({sessionId:+new Date,pageInSession:0},p)})},a=function(a,d){d=d||g.emptyFn;var c={sessionId:a.sessionId,pageInSession:a.pageInSession};
k.setItem({key:"Tracker.session",value:c,expires:0},function(a){a||(b["Tracker.session"]=c);d(c)})},m=function(a){var d=Math.floor(1E15*Math.random());k.setItem({key:"Tracker.visitorId",value:d,expires:"never"},function(c){c||(b["Tracker.visitorId"]=d);a(d)})},w=function(a){b.hasOwnProperty("api.account.getToken")?a(b["api.account.getToken"]):SpilGames("api.account.getToken",{cache:!0},function(d){var c=d.auth.token.substr(8,16);b["api.account.getToken"]=c;d.isError||a(c)})},r=function(a,b){a=a||
"";b=b||function(a){return a};return function(){var c=a.substr(1),e,f,m=[];g.each(c.split("&"),function(a){f=a.split("=");if(0===a.length)return!1;e=b({name:f[0],value:2===f.length?f[1]:null});g.isObject(e)&&m.push(e)});return m}()},u=function(a){var b="campaignMedium campaignSource campaignName campaignElement adwordsAdgroupId adwordsKeyword".split(" "),c=["utm_medium","utm_source","utm_campaign","utm_content"],e=[];g.each(b,function(a){e.push(a.toLowerCase())});return r(a,function(a){var p=a.name.toLowerCase();
if(g.contains(e,p))return a.name=b[e.indexOf(p)],a;if(g.contains(c,p))return a.name=b[c.indexOf(p)],a})},v=function(){var a={},b=window.document,c=window.navigator,e=h.globals;a.location=e.hasOwnProperty("location")?e.location:b.URL;a.referrer=e.hasOwnProperty("referrer")?e.referrer:b.referrer;a.userAgent=e.hasOwnProperty("userAgent")?e.userAgent:c.userAgent;return a},t=function(){var a=function(a){var b={},d=window.document.createElement("a");d.href=a;g.each("href host hostname pathname port protocol search hash".split(" "),
function(a){b[a]=0<d[a].length?d[a]:null});return b},b=v();return{referrer:a(b.referrer),location:a(b.location),userAgent:b.userAgent,environment:n}};h.globals={};h.getVisitorId=function(a){b.hasOwnProperty("Tracker.visitorId")?a(b["Tracker.visitorId"]):k.getItem("Tracker.visitorId",function(b){b?a(b):m(a)})};return{getPageInfo:function(){var a=t(),b,c,e;b={pageType:f.get("pagetype"),pageTypeDetail:f.get("pagetypedetail"),portalVersion:f.get("portalversion"),requestId:f.get("requestid"),userAgent:a.userAgent,
referrerURL:a.referrer.href,theme:f.get("theme")};c=f.get("testgroup");e=f.get("testvariant");if(c||e)b.testGroup=c,b.testVariant=e;c=f.get("pageid");/^[0-9]+$/.test(c)&&(b.pageId=c);(c=f.get("devicetype"))&&(b.deviceType=c);g.each(u(a.location.search),function(a){b[a.name]=a.value});return b},getCommonData:function(b,d,e){e=!1;b.environment=n;w(function(f){b.token=f;h.getVisitorId(function(f){b.visitorId=f;c(function(c){e&&a(c);g.combine(b,c);d(b)})})})},incrementPageInSession:function(b){c(function(c){c.pageInSession+=
1;a(c,b)})},getPageInSession:function(a){c(function(b){a(b.pageInSession)})},getSessionId:function(a){c(function(b){a(b.sessionId)})},getVisitorId:h.getVisitorId,setGlobals:function(a){h.globals=a}}}});SpilGames("spilgames.import",{name:"Tracker",deps:["TrackerData","Utils","Net","JSON"],module:function(g,k,l,e){var f=this.getApi(),q=new Image,h,n=function(b){var c="",a;for(a in b)!k.isEmpty(b[a])&&k.has(b,a)&&(c=k.isObject(b[a])?c+n(b[a]):c+("&"+a+"="+encodeURIComponent(b[a])));2E3<c.length&&(c=c.substring(0,2E3));return c};f.get(this.ns+".module.tracker.endpoint")||f.set(this.ns+".module.tracker.endpoint","{$tracker_endpoint}");h=f.get(this.ns+".module.tracker.endpoint");return{getVisitorId:g.getVisitorId,
setNet:function(b){l=b},send:function(b,c){var a=b.settings;c=c||k.emptyFn;switch(a.sendFormat){case "autoselect":case "xhr":case "cors":case "jsonp":g.getCommonData(b.request,function(b){b=e.stringify(b);"autoselect"===a.sendFormat?l.set("transport",["cors","jsonp"]):l.set("transport",[a.sendFormat]);l.send({url:h,type:a.sendMethod,data:b},k.emptyFn);c(b)});break;case "gif":g.getCommonData(b.request,function(b){q.src="string"===a.dataFormat?h+"?"+n(b).substring(1):h+"?"+e.stringify(b);k.isFunction(c)&&
c(b)})}}}}});SpilGames("spilgames.import",{name:"ThumbnailTracker",deps:["DOMSelect","SWPUtils","BeLazy","EventTracker"],module:function(g,k,l,e){var f=[],q=null,h=function(a){if(a.getAttribute("data-appid")||a.getAttribute("data-path"))f.push(a),q||(q=setTimeout(n,1E3))},n=function(){var a,b=[],c=[];q=null;a=f;f=[];b={};k.each(a,function(a){if(!a.getAttribute("data-ctr-processed")){var c=a.getAttribute("data-widget")||"unknown",e=a.getAttribute("data-label"),f=c+e;b[f]||(b[f]={widget:c,data:[]},e&&(b[f].label=
e));var c=a.getBoundingClientRect(),e=void 0!==window.pageYOffset?window.pageYOffset:document.documentElement.scrollTop,g=void 0!==window.pageYOffset?window.pageXOffset:document.documentElement.scrollLeft;b[f].data.push({id:a.getAttribute("data-appid")||0,path:a.getAttribute("data-path")||"-",index:a.getAttribute("data-index")||0,x:Math.floor(c.left+g),y:Math.floor(c.top+e)});a.setAttribute("data-ctr-processed",!0)}});k.each(b,function(a){a.data=JSON.stringify(a.data);c.push({eventCategory:"thumbnail",
eventAction:"view",properties:a})});e.trackExpress(c)},b=function(a){k.each(g.getAll("img[data-appid]",a),c);k.each(g.getAll("img[data-path]",a),c)},c=function(a){if(a.getAttribute("data-appid")||a.getAttribute("data-path"))k.hasClass(a,"lazyload")||a.getAttribute("data-ctr-processed")||l.until("visible",a,h,!1)};return{init:function(){l.registerImageloadCallback(h);b(document)},track:b,trackElement:c}}});