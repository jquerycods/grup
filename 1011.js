SpilGames(["SWP","SWPUtils","Net","DOMEvent"],function(n,d,z,g){n.init("search_bar");var r=window.document,t=r.getElementById("wdg_search_bar"),A=n.getProperty("microservice_url"),u=function(){var a={};return{set:function(c,b){a[c]=b},get:function(c){return a[c]||!1}}}(),h=function(a,c){c=c||t;return c.querySelector(a)},v=function(a){return h(".template",a).outerHTML.replace("data-src","src").replace(' class="template"',"")},e=h("#search-term"),f=h(".search-suggestions"),p=h(".labels"),k=h("ul",p),
B=v(k),p=h(".games"),l=h("ul",p),C=v(l),b=-1;if(f){var m=function(){var a;!r.getElementsByClassName&&e.createTextRange&&(e.select(),a=e.createTextRange(),a.collapse(!1),a.select())},w,q=function(){k.innerHTML="";l.innerHTML="";d.removeClass(f,"visible")},D=function(a){var c=a.q,b=u.get(c);b?(x({searchTerm:c,data:b}),m()):z.send({url:A,data:a,onsuccess:function(a){u.set(c,a);x({searchTerm:c,data:a});m()},onerror:function(a){d.error(a)}},function(){})},y=function(){var a=e.value,a=20<a.length?a.substring(0,
20):a;2<=a.length?D({q:encodeURIComponent(a)}):(q(),m())},x=function(a){a=JSON.parse(a.data);var c=function(a,c){return a.replace(/{(.*?)}/g,function(a,b){return c[b]})},b=function(a,b){return a.map(function(a){return c(b,a)}).join("")};q();k.innerHTML=b(a.suggestions.label.slice(0,3),B);l.innerHTML=b(a.suggestions.game.slice(0,5),C);""===k.innerHTML&&""===l.innerHTML||d.addClass(f,"visible");""!==k.innerHTML?d.addClass(f,"has-labels"):d.removeClass(f,"has-labels");""!==l.innerHTML?d.addClass(f,"has-games"):
d.removeClass(f,"has-games")};g.add(t,"submit",function(a){var c=e.value,d;d=c.substr(0,1E3);SpilGames("tracker.event.express",{data:{eventCategory:"search",eventAction:"application",eventLabel:"submit",properties:{searchTerm:d}}});0<=b?(g.preventDefault(a),a=f.querySelectorAll("li")[b].querySelector("a"),window.location=a.href):2<=c.length&&e.placeholder!==c&&!~c.indexOf("@")?n.System.emit("user.search.request",{searchTerm:c}):g.preventDefault(a)});g.add(e,"keyup",function(a){38!==a.keyCode&&40!==
a.keyCode&&y()});g.add(e,"keydown",function(a){switch(a.keyCode){case 38:g.preventDefault(a);a=f.querySelectorAll("li");d.removeClass(a[b],"is-selected");b=0<b?--b:a.length-1;d.addClass(a[b],"is-selected");break;case 40:g.preventDefault(a);a=f.querySelectorAll("li");d.removeClass(a[b],"is-selected");b=++b%a.length;d.addClass(a[b],"is-selected");break;case 13:break;default:b=-1}});g.add(e,"focus",function(){window.clearTimeout(w);y()});g.add(e,"blur",function(){w=window.setTimeout(function(){q();m()},
1E3)})}});